#!/usr/bin/env zsh

fpath=("$ZDOTDIR/extras/custom-scripts" $fpath)

# +------+
# | OPTS |
# +------+
setopt   AUTO_CD          # Go to folder path without using cd.
setopt   AUTO_MENU        # show completion menu on succesive tab presses
setopt   COMPLETE_IN_WORD # cd /ho/sco/tm<TAB> expands to /home/scott/tmp

setopt   CDABLE_VARS      # Change directory to a path stored in a variable
setopt   EXTENDED_GLOB    # Use extended globbing syntax

unsetopt CORRECT_ALL      # Try to correct the spelling of all arguments in a line

# +------+
# | PATH |
# +------+
typeset -U path

# +-----------+
# | VI KEYMAP |
# +-----------+
bindkey -v
export KEYTIMEOUT=1

# # Add Vi text-objects for brackets and quotes
# autoload -Uz select-bracketed select-quoted
# zle -N select-quoted
# zle -N select-bracketed
# for km in viopp visual; do
#     bindkey -M $km -- '-' vi-up-line-or-history
#     for c in {a,i}${(s..)^:-\'\"\`\|,./:;=+@}; do
#         bindkey -M $km $c select-quoted
#     done
#     for c in {a,i}${(s..)^:-'()[]{}<>bB'}; do
#         bindkey -M $km $c select-bracketed
#     done
# done
#
# # Emulation of vim-surround
# autoload -Uz surround
# zle -N delete-surround surround
# zle -N add-surround surround
# zle -N change-surround surround
# bindkey -M vicmd cs change-surround
# bindkey -M vicmd ds delete-surround
# bindkey -M vicmd ys add-surround
# bindkey -M visual S add-surround
#
# # Increment a number
# autoload -Uz incarg
# zle -N incarg
# bindkey -M vicmd '^a' incarg

# +----------------+
# | TAB COMPLETION |
# +----------------+
autoload -Uz compinit
if [[ -n "${ZDOTDIR}/.zcompdump"(#qN.mh+24) ]]; then
    compinit;
else
    compinit -C;
fi;
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
ZLE_REMOVE_SUFFIX_CHARS=$' \t\n;&'

# +---------+
# | ALIASES |
# +---------+
source "$ZDOTDIR/extras/aliases"

# +-----+
# | FZF |
# +-----+
source <(fzf --zsh)

# +----------+
# | Antidote |
# +----------+
source "$ZDOTDIR/.antidote/antidote.zsh"
antidote load

# +--------+
# | PROMPT |
# +--------+
autoload -Uz promptinit && promptinit && prompt pure

# +--------+
# | ZOXIDE |
# +--------+
eval "$(zoxide init zsh)"

# +---------+
# | BINDING |
# +---------+
bindkey -M viins 'jk' vi-cmd-mode

bindkey -r '^l'
bindkey -r '^g'
bindkey -r '^p'

autoload -Uz edit-command-line
zle -N edit-command-line
bindkey -M vicmd '^v' edit-command-line

bindkey '^f' autosuggest-accept
bindkey ' ' magic-space

# +--------------------------+
# | Startup (keep at bottom) |
# +--------------------------+
if [[ -z $TMUX && $TERM == "xterm-kitty" && -z $NEOVIDE ]]; then
    tmux attach-session || tmux;
fi
